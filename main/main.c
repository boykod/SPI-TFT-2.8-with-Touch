//-----------------------------------------------------------------------------
// Includes
//-----------------------------------------------------------------------------
#include <SI_EFM8UB2_Register_Enums.h>
#include "main.h"
#include "../ili9341/ILI9341.h"
#include "../xpt2046/XPT2046.h"
#include "InitDevice.h"

//-----------------------------------------------------------------------------
// Global Variables
//-----------------------------------------------------------------------------
xdata uint16_t coordinatX = 0;
xdata uint16_t coordinatY = 0;

//-----------------------------------------------------------------------------
// SiLabs_Startup() Routine
//-----------------------------------------------------------------------------
void SiLabs_Startup (void) {
  // Disable the watchdog here
}
 
//-----------------------------------------------------------------------------
// main() Routine
//-----------------------------------------------------------------------------
void main (void) {

   enter_DefaultMode_from_RESET();

//   IE_EA = 1;                             		// Enable global interrupts

   _ILI9341_Init();
   _XPT2046_Init();

   setRotation(2);

   fillScreen(ILI9341_WHITE);
   fillRect(10, 10, 105, 40, ILI9341_RED);
   fillRect(125, 10, 105, 40, ILI9341_BLUE);

   while (1) {
	   testTouch();
   }
}

//-----------------------------------------------------------------------------
// Support Routines
//-----------------------------------------------------------------------------
//-----------------------------------------------------------------------------
// testLCD
//-----------------------------------------------------------------------------
//void testLCD() {
//	setRotation(0);
//	fillScreen(ILI9341_RED);
//
//	setRotation(2);
//	fillScreen(ILI9341_YELLOW);
//
//	setRotation(1);
//	fillScreen(ILI9341_GREEN);
//
//	setRotation(3);
//	fillScreen(ILI9341_BLUE);
//	Delay();
//}
//-----------------------------------------------------------------------------
// testTouch
//-----------------------------------------------------------------------------
void testTouch() {
	coordinatX = getX();
	coordinatY = getY();

	if(getY() > 276 && getY() < 300) {
		//Red button
		if(getX() > 10 && getX() < 100) {
			fillRect(0, 160, 240, 160, ILI9341_RED);
		}
		//Blue button
		if(getX() > 132 && getX() < 222) {
			fillRect(0, 160, 240, 160, ILI9341_BLUE);
		}
	}
}
//-----------------------------------------------------------------------------
// Delay
//-----------------------------------------------------------------------------
void Delay (void) {
   uint32_t count;

   for (count = 1000; count > 0; count--);
}

//-----------------------------------------------------------------------------
// End Of File
//-----------------------------------------------------------------------------
